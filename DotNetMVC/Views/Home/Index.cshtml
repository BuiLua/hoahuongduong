@{
    ViewBag.Title = "Home Page";
}
@model FirstDatabaseProject.ViewModels.HomeIndexViewModel

@section scripts {
    <script>
        $(document).ready(function () {
            $('.btn-open-new-blog').on('click', function (event) {
                //Mở modal ở đây
                $('#modal-add-new-blog').modal('show');
            });

            //thêm mới blog
            $('.btn-add-new-blog').on('click', function (event) {
                //Kiểm tra nội dung text blog-name và gọi lưu thông tin
                var blogName = $('#new-blog-name').val();

                //Kiểm tra chuỗi khác rống
                if (blogName && blogName !== '' && blogName.trim() !== '') {
                    //Gọi ajax lên Server
                    $.ajax({
                        type: 'post',
                        url: "/Home/AddNewBlog",
                        data: {
                            Name: blogName
                        },
                        success: function (response) {
                            if (response.isSuccess) {
                                //Tu dong F5 trang web
                                Swal(
                                    'Thành công',
                                    '',
                                    'success'
                                ).then(function () {
                                    location.reload();
                                });
                            } else {
                                Swal({
                                    type: 'error',
                                    title: '',
                                    text: 'Xảy ra lỗi khi thêm mới!'
                                });
                            }
                        }
                    });
                } else {
                    Swal({
                        type: 'error',
                        title: '',
                        text: 'Blog name không hợp lệ!'
                    });
                }
            });

            //sửa blog
            $('.btn-open-edit-blog').on('click', function (event) {

                var self = $(this);
                var modalUpdate = $('#modal-update-blog');
                modalUpdate.find('.modal-title').html('Edit blog : ' + self.data('blog-name'));
                modalUpdate.find('.btn-update-blog').data('blog-id', self.data('blog-id'));
                $('#edit-blog-name').val(self.data('blog-name'));

                //Mở modal ở đây
                modalUpdate.modal('show');
            });

            $('.btn-update-blog').on('click', function (event) {

                var self = $(this);

                //Kiểm tra nội dung text blog-name và gọi lưu thông tin
                var blogName = $('#edit-blog-name').val();

                //Kiểm tra chuỗi khác rống
                if (blogName && blogName !== '' && blogName.trim() !== '') {
                    //Gọi ajax lên Server
                    $.ajax({
                        type: 'post',
                        url: "/Home/UpdateBlog",
                        data: {
                            BlogId: self.data('blog-id'),
                            Name: blogName
                        },
                        success: function (response) {
                            if (response.isSuccess) {
                                //Tu dong F5 trang web
                                Swal(
                                    'Thành công',
                                    '',
                                    'success'
                                ).then(function () {
                                    location.reload();
                                });
                            } else {
                                Swal({
                                    type: 'error',
                                    title: '',
                                    text: 'Xảy ra lỗi khi update!'
                                });
                            }
                        }
                    });
                } else {
                    Swal({
                        type: 'error',
                        title: '',
                        text: 'Blog name không hợp lệ!'
                    });
                }
            });

            //xóa blog
            $('.btn-delete-blog').on('click', function () {

                var self = $(this);
                var blogName = self.data("blog-name");
                var blogId = self.data("blog-id");

                Swal.fire({
                    title: `Bạn có chắc muốn xóa blog ${blogName}?`,
                    text: "",
                    type: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Đồng ý!',
                    cancelButtonText: 'Hủy'
                }).then((result) => {
                    if (result.value) {
                        //Gọi ajax lên Server
                        $.ajax({
                            type: 'post',
                            url: "/Home/DeleteBlog",
                            data: {
                                blogId: blogId
                            },
                            success: function (response) {
                                if (response.isSuccess) {
                                    //Tu dong F5 trang web
                                    Swal(
                                        'Thành công',
                                        '',
                                        'success'
                                    ).then(function () {
                                        location.reload();
                                    });
                                } else {
                                    Swal({
                                        type: 'error',
                                        title: '',
                                        text: 'Xảy ra lỗi khi delete!'
                                    });
                                }
                            }
                        });
                    }
                })
            });
        });
    </script>
}

<div class="margin-top-20">
    <button type="button" class="btn btn-info btn-open-new-blog">Create new blog</button>
</div>

<table class="table table-bordered table-striped margin-top-20">
    <thead>
        <tr>
            <th>BlogId</th>
            <th>BlogName</th>
            <th>Links to Post</th>
            <th>Options</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var blog in Model.ListBlogs)
        {
            <tr>
                <td>@blog.BlogId</td>
                <td>@blog.Name</td>
                <td>
                    @*ListPosts : ten action, Post : ten controller*@
                    <a href="@Url.Action("ListPosts", "Post", new { @blogId = blog.BlogId })">
                        Links to Post
                    </a>
                </td>
                <td>
                    <button type="button" class="btn btn-primary btn-open-edit-blog" data-blog-id="@blog.BlogId" data-blog-name="@blog.Name">Edit</button>
                    <button type="button" class="btn btn-success btn-delete-blog" data-blog-id="@blog.BlogId" data-blog-name="@blog.Name">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>

@*Modal them blog*@
<div id="modal-add-new-blog" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Add new blog</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="email">Blog Name</label>
                    <input type="text" class="form-control" id="new-blog-name">
                </div>
                <button type="button" class="btn btn-success btn-add-new-blog">Add</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success btn-add-new-blog">Add</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>

@* Modal sua blog *@
<div id="modal-update-blog" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Edit Blog</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="email">Blog Name</label>
                    <input type="text" class="form-control" id="edit-blog-name">
                </div>
                <button type="button" class="btn btn-success btn-update-blog">Update</button>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success btn-update-blog">Update</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>

    </div>
</div>